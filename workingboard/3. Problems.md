# 问题集

> 当前版本: ver 0.40

本文档记录 AccelWorld 项目的问题和待改进项，按严重程度分类。

记录中使用到的格式：

- 实现难度：[简单,中等,复杂]
- 优先级：[最高,高,中,低,暂缓]
- 状态：[待修复,✅ 修复完成,评估中,已拒绝]

---

## [P01].[致命]（影响程序无法运行的问题）

暂无已发现的致命问题。

## [P02].[严重]（影响核心功能的问题）

### [P02a].[天气模块 WEATHER_CODES 字典重复键问题] → [F01a01]

问题描述：accelworld_weather.py 中第 42-71 行的 WEATHER_CODES 字典存在重复键。键值 51、52、53 等被多次定义，导致字典初始化时后面的值会覆盖前面的值，可能导致某些天气代码无法正确映射。

问题影响：部分天气代码可能显示错误的天气图标或描述，影响用户体验。

复现步骤：

1. 打开 accelworld_weather.py
2. 检查 WEATHER_CODES 字典定义（第 42-71 行）
3. 发现键 51、52、53 等出现多次

修复优先级：高

状态：[待修复]

### [P02b].[命令行参数缺少完整验证] → [F01c01]

问题描述：accelworld.py 中命令行参数验证不完整。例如 --rate 参数虽然有 default 和 type 检查，但用户可以传入任意值（如负数、小于 1.0 的值）而不被拒绝。

问题影响：无效参数可能导致程序异常或不可预期的行为。

复现步骤：

- python accelworld.py --rate 0.5

修复优先级：高

状态：[待修复]

## [P03].[一般]（影响用户体验的问题）

### [P03a].[滑杆拖动时输入框不同步] → [F01b01]

问题描述：在 GUI 中拖动滑杆时，输入框中的数值不会同步更新。用户需要手动输入数值并点击"应用加速"按钮才能更新输入框显示。

问题影响：用户体验不一致，UI 状态与实际值不同步。

复现步骤：

1. 启动程序
2. 拖动滑杆
3. 观察输入框数值未更新

修复优先级：中

状态：[待修复]

### [P03b].[倒计时输入格式提示不足] → [F01b03]

问题描述：倒计时输入框的占位符显示格式提示，但用户输入错误格式时错误信息不够友好，且没有链接到格式示例。

问题影响：新用户可能不知道如何正确输入时间格式。

复现步骤：

1. 在倒计时输入框输入错误格式
2. 点击"设置"按钮
3. 观察错误提示信息

修复优先级：中

状态：[待修复]

### [P03c].[异常处理使用 print 而非日志] → [F01a02] + [F01a03]

问题描述：多个模块（accelworld_weather.py、accelworld_config.py、accelworld_gui.py）使用 print 语句输出错误信息，而非使用 logging 模块。

问题影响：

1. 无法控制日志级别
2. 难以追踪程序运行状态
3. 不便于调试和问题排查

复现步骤：

- 检查各模块中的 except 块，使用 print 而非 logging

修复优先级：中

状态：[待修复]

## [P04].[轻微]（小问题，不影响使用）

### [P04a].[GUI 代码未使用 Qt Designer] → [F02b03]

问题描述：accelworld_gui.py 中的 UI 布局完全使用代码编写，未使用 Qt Designer 生成 .ui 文件。

问题影响：

1. UI 代码与业务逻辑耦合
2. 修改 UI 需要修改代码
3. 不便于设计师参与

修复优先级：低

状态：[待修复]

### [P04b].[主题样式硬编码在 GUI 模块] → [F02b04]

问题描述：浅色/深色主题的 QSS 样式表硬编码在 accelworld_gui.py 文件顶部。

问题影响：

1. 代码文件过大（904 行）
2. 主题样式与 GUI 逻辑耦合
3. 不便于添加新主题

修复优先级：低

状态：[待修复]

### [P04c].[缺少单元测试] → [F02b01]

问题描述：项目目前没有单元测试代码。

问题影响：

1. 无法保证代码质量
2. 重构时容易引入 bug
3. 新功能难以验证正确性

修复优先级：低

状态：[待修复]

### [P04d].[类型注解不完整] → [F02b02]

问题描述：部分函数缺少类型注解，尤其是 accelworld_gui.py 中的类方法。

问题影响：

1. 基于 basedpyright 的类型检查会报警告
2. IDE 无法提供准确的代码补全
3. 代码可维护性降低

修复优先级：低

状态：[待修复]

## [P05].[建议]（改进建议和优化方向）

### [P05a].[添加天气数据缓存机制] → [F01c02]

建议内容：当前每次获取天气都会调用 Open-Meteo API，建议添加本地缓存机制（缓存 30 分钟），减少 API 调用频率。

预期效果：减少网络请求，降低 API 限流风险，提升响应速度。

实现难度：简单

优先级：暂缓

状态：[评估中]

### [P05b].[添加托盘图标实时更新] → [F01c03]

建议内容：在托盘图标上显示当前时间或倍率信息，使用 QSystemTrayIcon 的 setToolTip 实时更新。

预期效果：用户无需打开窗口即可查看基本信息。

实现难度：简单

优先级：暂缓

状态：[评估中]

### [P05c].[添加快捷键支持] → [F02a01]

建议内容：为 GUI 添加全局快捷键，如 Ctrl+S 保存设置、Ctrl+Q 退出、Ctrl+T 切换主题等。

预期效果：提升用户操作效率。

实现难度：简单

优先级：暂缓

状态：[评估中]

### [P05d].[添加闹铃功能] → [F02a03]

建议内容：在倒计时基础上添加闹铃/提醒功能，支持自定义闹铃声音和时间。

预期效果：扩展程序功能，提升实用性。

实现难度：中等

优先级：暂缓

状态：[评估中]

### [P05e].[添加多语言界面支持] → [F02a02]

建议内容：实现界面语言切换功能，支持中文、英文、日文。

预期效果：扩大用户群体，提升国际化程度。

实现难度：中等

优先级：暂缓

状态：[评估中]

### [P05f].[添加加速倍率预设方案] → [F02a04]

建议内容：添加常用的加速倍率预设方案，如"工作模式"、"睡眠模式"、"专注模式"等。

预期效果：方便用户快速切换常用倍率。

实现难度：简单

优先级：暂缓

状态：[评估中]

---

## 链接图示：

| 链接状态 | 问题编号 | 问题描述                      | 对应计划项            |
| :------: | :------: | ----------------------------- | --------------------- |
|    ✅    |  [P02a]  | 天气模块 WEATHER_CODES 重复键 | → [F01a01]            |
|    ✅    |  [P02b]  | 命令行参数缺少完整验证        | → [F01c01]            |
|    ✅    |  [P03a]  | 滑杆拖动时输入框不同步        | → [F01b01]            |
|    ✅    |  [P03b]  | 倒计时输入格式提示不足        | → [F01b03]            |
|    ✅    |  [P03c]  | 异常处理使用 print 而非日志   | → [F01a02] + [F01a03] |
|    ✅    |  [P04a]  | GUI 代码未使用 Qt Designer    | → [F02b03]            |
|    ✅    |  [P04b]  | 主题样式硬编码在 GUI 模块     | → [F02b04]            |
|    ✅    |  [P04c]  | 缺少单元测试                  | → [F02b01]            |
|    ✅    |  [P04d]  | 类型注解不完整                | → [F02b02]            |
|    ✅    |  [P05a]  | 建议：天气数据缓存机制        | → [F01c02]            |
|    ✅    |  [P05b]  | 建议：托盘图标实时更新        | → [F01c03]            |
|    ✅    |  [P05c]  | 建议：添加快捷键支持          | → [F02a01]            |
|    ✅    |  [P05d]  | 建议：闹铃功能                | → [F02a03]            |
|    ✅    |  [P05e]  | 建议：多语言界面支持          | → [F02a02]            |
|    ✅    |  [P05f]  | 建议：加速倍率预设方案        | → [F02a04]            |

> 说明：所有问题（P01-P05）均已链接到对应的计划项（[F01]-[F03]），其中 [P03c] 关联两个计划项。

## 问题综述

- **[P01]** 无致命问题
- **[P02]** 严重问题：2 项（P02a-P02b）
- **[P03]** 一般问题：3 项（P03a-P03c）
- **[P04]** 轻微问题：4 项（P04a-P04d）
- **[P05]** 建议项：6 项（P05a-P05f）
